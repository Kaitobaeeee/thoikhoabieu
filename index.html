<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Th·ªùi kh√≥a bi·ªÉu & ƒê·ªìng h·ªì & T·ª´ v·ª±ng</title>
  <style>
    *{
      font-family:Arial, Helvetica, sans-serif;
    }
    body{
      margin:0;
      background:linear-gradient(135deg,#0084ff,#1e293b);
      font-family:'Poppins',Arial,sans-serif;
      color:#f1f5f9;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:20px;
      min-height:100vh;
    }
    
    /* ===== ƒê·ªìng h·ªì ===== */
    .clock-box{
      background:linear-gradient(145deg,#1e293b,#0f172a);
      padding:25px 40px;
      border-radius:20px;
      text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.5);
      margin-bottom:25px;
      max-width:400px;
      width:90%;
    }
    .clock-box h2{margin:0;color:#d0bae9;font-size:22px;letter-spacing:1px}
    .date{margin-top:6px;color:#94a3b8;font-size:15px}
    .time{margin-top:15px;font-size:50px;font-weight:800;color:#e0c3da;letter-spacing:2px}
    
    /* ===== Stopwatch ===== */
    .stopwatch{margin-top:20px}
    .stopwatch-time{font-size:28px;font-weight:700;margin-bottom:12px;color:#f1f5f9}
    .stopwatch button{
      margin:0 6px;
      padding:8px 16px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      transition:transform .2s,opacity .2s;
      font-size:14px;
    }
    .stopwatch button:hover{transform:scale(1.05);opacity:0.9}
    .stopwatch button:active{transform:scale(0.98)}
    .start{background:#0fd658;color:#fff}
    .stop{background:#ef4444;color:#fff}
    .reset{background:#3b82f6;color:#fff}
    
    /* ===== Vocabulary Test ===== */
    .vocab-box{
      background:linear-gradient(145deg,#1e293b,#0f172a);
      padding:30px;
      border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,0.5);
      margin-top:25px;
      max-width:600px;
      width:90%;
    }
    .vocab-box h3{
      margin:0 0 20px 0;
      color:#d0bae9;
      font-size:24px;
      text-align:center;
      letter-spacing:0.5px;
    }
    .vocab-input-group{margin-bottom:20px}
    .vocab-input-group label{
      display:block;
      margin-bottom:8px;
      color:#94a3b8;
      font-size:14px;
      font-weight:600;
    }
    .vocab-input-group textarea{
      width:100%;
      padding:12px;
      border:2px solid #334155;
      border-radius:10px;
      background:#0f172a;
      color:#f1f5f9;
      font-size:15px;
      resize:vertical;
      min-height:120px;
      box-sizing:border-box;
      transition:border-color .2s;
    }
    .vocab-input-group input{
      width:100%;
      padding:12px;
      border:2px solid #334155;
      border-radius:10px;
      background:#0f172a;
      color:#f1f5f9;
      font-size:16px;
      box-sizing:border-box;
      transition:border-color .2s;
    }
    .vocab-input-group input:focus,.vocab-input-group textarea:focus{
      outline:none;
      border-color:#0084ff;
    }
    .vocab-btn{
      width:100%;
      padding:12px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      font-size:16px;
      transition:transform .2s,opacity .2s;
      margin-top:10px;
    }
    .vocab-btn:hover{transform:scale(1.02);opacity:0.9}
    .vocab-btn:active{transform:scale(0.98)}
    .btn-start{background:#0fd658;color:#fff}
    .btn-check{background:#3b82f6;color:#fff}
    .btn-next{background:#f59e0b;color:#fff}
    .btn-reset{background:#ef4444;color:#fff}
    
    .vocab-display{
      background:#0f172a;
      padding:25px;
      border-radius:10px;
      margin-bottom:15px;
      text-align:center;
      border:2px solid #1e293b;
    }
    .vocab-word{
      font-size:36px;
      font-weight:700;
      color:#0fd658;
      margin-bottom:15px;
      letter-spacing:1px;
    }
    
    /* ===== Pronunciation Button ===== */
    .pronunciation-btn{
      margin:10px 0;
      padding:10px 20px;
      border:2px solid #0fd658;
      border-radius:10px;
      background:transparent;
      color:#0fd658;
      cursor:pointer;
      font-weight:600;
      font-size:16px;
      transition:all .2s;
      display:inline-block;
    }
    .pronunciation-btn:hover{
      background:#0fd658;
      color:#fff;
      transform:scale(1.05);
    }
    .pronunciation-btn:active{
      transform:scale(0.95);
    }
    
    .vocab-result{
      margin-top:15px;
      padding:15px;
      border-radius:10px;
      font-weight:600;
      text-align:center;
      font-size:16px;
    }
    .correct{
      background:#0fd65820;
      color:#0fd658;
      border:2px solid #0fd658;
    }
    .incorrect{
      background:#ef444420;
      color:#ef4444;
      border:2px solid #ef4444;
    }
    .vocab-stats{
      display:flex;
      justify-content:space-around;
      margin-top:20px;
      padding:15px;
      background:#0f172a;
      border-radius:10px;
      border:2px solid #1e293b;
    }
    .stat-item{text-align:center}
    .stat-label{
      color:#94a3b8;
      font-size:13px;
      margin-bottom:5px;
    }
    .stat-value{
      color:#e0c3da;
      font-size:24px;
      font-weight:700;
    }
    .hidden{display:none}
    
    .instruction{
      color:#94a3b8;
      font-size:13px;
      text-align:center;
      margin-top:10px;
      font-style:italic;
    }
    
    @media (max-width: 600px) {
      .vocab-box{padding:20px}
      .vocab-word{font-size:28px}
      .time{font-size:40px}
      .stopwatch-time{font-size:24px}
    }
  </style>
</head>
<body>
  <!-- ƒê·ªìng h·ªì + Stopwatch -->
  <div class="clock-box">
    <h2 id="weekday">‚Äî</h2>
    <div class="date" id="date">‚Äî</div>
    <div class="time" id="time">--:--:--</div>
    <div class="stopwatch">
      <div class="stopwatch-time" id="stopwatch">00:00:00</div>
      <button class="start" onclick="startStopwatch()">B·∫Øt ƒë·∫ßu</button>
      <button class="stop" onclick="stopStopwatch()">D·ª´ng</button>
      <button class="reset" onclick="resetStopwatch()">Reset</button>
    </div>
  </div>

  <!-- Vocabulary Test -->
  <div class="vocab-box">
    <h3>üìö Ki·ªÉm tra t·ª´ v·ª±ng Ti·∫øng Anh</h3>
    
    <!-- Setup Phase -->
    <div id="setupPhase">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
        <div class="vocab-input-group">
          <label>T·ª´ Ti·∫øng Anh (m·ªói t·ª´ m·ªôt d√≤ng):</label>
          <textarea id="vocabEnglish" placeholder="V√≠ d·ª•:&#10;apple&#10;book&#10;computer&#10;student&#10;teacher"></textarea>
        </div>
        <div class="vocab-input-group">
          <label>Nghƒ©a Ti·∫øng Vi·ªát (m·ªói nghƒ©a m·ªôt d√≤ng):</label>
          <textarea id="vocabVietnamese" placeholder="V√≠ d·ª•:&#10;qu·∫£ t√°o&#10;cu·ªën s√°ch&#10;m√°y t√≠nh&#10;h·ªçc sinh&#10;gi√°o vi√™n"></textarea>
        </div>
      </div>
      <div class="instruction">üí° Nh·∫≠p s·ªë l∆∞·ª£ng t·ª´ ti·∫øng Anh v√† nghƒ©a t∆∞∆°ng ·ª©ng ph·∫£i b·∫±ng nhau</div>
      <button class="vocab-btn btn-start" onclick="startTest()">B·∫Øt ƒë·∫ßu ki·ªÉm tra</button>
    </div>

    <!-- Test Phase -->
    <div id="testPhase" class="hidden">
      <div class="vocab-display">
        <div class="vocab-word" id="currentWord">‚Äî</div>
        <button class="pronunciation-btn" onclick="pronounceWord()" title="Ph√°t √¢m t·ª´ n√†y">
          üîä Nghe ph√°t √¢m
        </button>
        <div style="color:#94a3b8;font-size:14px;margin-top:15px">Nh·∫≠p nghƒ©a Ti·∫øng Vi·ªát:</div>
      </div>
      
      <div class="vocab-input-group">
        <input type="text" id="answerInput" placeholder="Nh·∫≠p nghƒ©a ti·∫øng Vi·ªát..." 
               onkeypress="if(event.key==='Enter')checkAnswer()"
               autocomplete="off">
      </div>
      
      <div id="resultMsg" class="vocab-result hidden"></div>
      
      <button class="vocab-btn btn-check" id="checkBtn" onclick="checkAnswer()">Ki·ªÉm tra</button>
      <button class="vocab-btn btn-next hidden" id="nextBtn" onclick="nextWord()">T·ª´ ti·∫øp theo</button>
      <button class="vocab-btn btn-reset" onclick="resetTest()">K·∫øt th√∫c & L√†m l·∫°i</button>
      
      <div class="vocab-stats">
        <div class="stat-item">
          <div class="stat-label">ƒê√£ l√†m</div>
          <div class="stat-value" id="statDone">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ƒê√∫ng</div>
          <div class="stat-value" id="statCorrect" style="color:#0fd658">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Sai</div>
          <div class="stat-value" id="statWrong" style="color:#ef4444">0</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== ƒê·ªìng h·ªì =====
    function titleCaseVietnamese(s){
      return s.split(/\s+/).map(w => w.charAt(0).toUpperCase()+w.slice(1).toLowerCase()).join(' ');
    }
    
    function updateClock(){
      const now = new Date();
      const opts = {
        timeZone: 'Asia/Ho_Chi_Minh',
        weekday: 'long',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      };
      const parts = new Intl.DateTimeFormat('vi-VN', opts).formatToParts(now);
      const map = {};
      for(const p of parts) map[p.type] = p.value;
      
      document.getElementById('weekday').textContent = titleCaseVietnamese(map.weekday);
      document.getElementById('date').textContent = `Ng√†y ${map.day} th√°ng ${map.month} nƒÉm ${map.year}`;
      document.getElementById('time').textContent = `${map.hour}:${map.minute}:${map.second}`;
    }
    
    setInterval(updateClock, 1000);
    updateClock();

    // ===== Stopwatch =====
    let stopwatchInterval;
    let elapsed = 0;
    let running = false;
    
    function formatTime(ms){
      const totalSec = Math.floor(ms / 1000);
      const h = String(Math.floor(totalSec / 3600)).padStart(2, '0');
      const m = String(Math.floor((totalSec % 3600) / 60)).padStart(2, '0');
      const s = String(totalSec % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }
    
    function startStopwatch(){
      if(running) return;
      running = true;
      const start = Date.now() - elapsed;
      stopwatchInterval = setInterval(() => {
        elapsed = Date.now() - start;
        document.getElementById('stopwatch').textContent = formatTime(elapsed);
      }, 1000);
    }
    
    function stopStopwatch(){
      running = false;
      clearInterval(stopwatchInterval);
    }
    
    function resetStopwatch(){
      elapsed = 0;
      document.getElementById('stopwatch').textContent = '00:00:00';
      if(running){
        clearInterval(stopwatchInterval);
        running = false;
      }
    }

    // ===== Vocabulary Test =====
    let vocabList = [];
    let currentIndex = 0;
    let userAnswers = [];
    let stats = {done: 0, correct: 0, wrong: 0};

    function startTest(){
      const englishInput = document.getElementById('vocabEnglish').value.trim();
      const vietnameseInput = document.getElementById('vocabVietnamese').value.trim();
      
      if(!englishInput || !vietnameseInput){
        alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t·ª´ ti·∫øng Anh v√† nghƒ©a ti·∫øng Vi·ªát!');
        return;
      }
      
      const englishWords = englishInput.split('\n').map(w => w.trim()).filter(w => w.length > 0);
      const vietnameseMeanings = vietnameseInput.split('\n').map(w => w.trim()).filter(w => w.length > 0);
      
      if(englishWords.length === 0 || vietnameseMeanings.length === 0){
        alert('Danh s√°ch t·ª´ v·ª±ng tr·ªëng!');
        return;
      }
      
      if(englishWords.length !== vietnameseMeanings.length){
        alert(`S·ªë l∆∞·ª£ng kh√¥ng kh·ªõp!\nTi·∫øng Anh: ${englishWords.length} t·ª´\nTi·∫øng Vi·ªát: ${vietnameseMeanings.length} nghƒ©a`);
        return;
      }
      
      // Create vocab pairs
      vocabList = englishWords.map((eng, i) => ({
        english: eng,
        vietnamese: vietnameseMeanings[i]
      }));
      
      // Shuffle vocabulary
      vocabList = vocabList.sort(() => Math.random() - 0.5);
      currentIndex = 0;
      userAnswers = new Array(vocabList.length).fill(null);
      stats = {done: 0, correct: 0, wrong: 0};
      
      document.getElementById('setupPhase').classList.add('hidden');
      document.getElementById('testPhase').classList.remove('hidden');
      
      updateStats();
      showWord();
    }

    function showWord(){
      if(currentIndex >= vocabList.length){
        const score = stats.correct;
        const total = vocabList.length;
        const percentage = Math.round((score / total) * 100);
        alert(`üéâ Ho√†n th√†nh t·∫•t c·∫£ ${total} t·ª´!\n\nƒêi·ªÉm s·ªë: ${score}/${total} (${percentage}%)\n‚úÖ ƒê√∫ng: ${stats.correct}\n‚ùå Sai: ${stats.wrong}`);
        return;
      }
      
      document.getElementById('currentWord').textContent = vocabList[currentIndex].english;
      document.getElementById('answerInput').value = '';
      document.getElementById('answerInput').focus();
      document.getElementById('resultMsg').classList.add('hidden');
      document.getElementById('checkBtn').classList.remove('hidden');
      document.getElementById('nextBtn').classList.add('hidden');
      
      // Auto-pronounce the word after a short delay
      setTimeout(pronounceWord, 400);
    }

    function checkAnswer(){
      const answer = document.getElementById('answerInput').value.trim();
      if(!answer){
        alert('Vui l√≤ng nh·∫≠p ƒë√°p √°n!');
        return;
      }
      
      userAnswers[currentIndex] = answer;
      const correctAnswer = vocabList[currentIndex].vietnamese;
      
      // Advanced normalization and fuzzy matching
      const normalize = str => str.toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/ƒë/g, 'd')
        .replace(/[^\w\s]/g, '') // Remove punctuation
        .replace(/\s+/g, ' ')    // Normalize spaces
        .trim();
      
      const normalizedAnswer = normalize(answer);
      const normalizedCorrect = normalize(correctAnswer);
      
      // Check exact match
      let isCorrect = normalizedAnswer === normalizedCorrect;
      let matchType = 'exact';
      
      // Check if answer contains all words from correct answer
      if(!isCorrect){
        const answerWords = normalizedAnswer.split(' ');
        const correctWords = normalizedCorrect.split(' ');
        
        // If lengths match and all words are present (different order)
        if(answerWords.length === correctWords.length){
          const allWordsPresent = correctWords.every(w => answerWords.includes(w));
          if(allWordsPresent){
            isCorrect = true;
            matchType = 'word-order';
          }
        }
      }
      
      // Check partial match (if correct answer has multiple meanings separated by /, or ,)
      if(!isCorrect && (correctAnswer.includes('/') || correctAnswer.includes(','))){
        const alternatives = correctAnswer.split(/[\/,]/).map(alt => normalize(alt.trim()));
        if(alternatives.some(alt => alt === normalizedAnswer)){
          isCorrect = true;
          matchType = 'alternative';
        }
      }
      
      // Levenshtein distance for typo tolerance (max 2 character difference)
      if(!isCorrect && normalizedAnswer.length >= 3){
        const distance = levenshteinDistance(normalizedAnswer, normalizedCorrect);
        const threshold = Math.max(2, Math.floor(normalizedCorrect.length * 0.15));
        if(distance <= threshold){
          isCorrect = true;
          matchType = 'typo';
        }
      }
      
      const resultDiv = document.getElementById('resultMsg');
      if(isCorrect){
        let message = '‚úÖ <strong>Ch√≠nh x√°c!</strong>';
        if(matchType === 'typo') message += ' (C√≥ l·ªói ch√≠nh t·∫£ nh·ªè)';
        if(matchType === 'word-order') message += ' (ƒê√∫ng nghƒ©a)';
        if(matchType === 'alternative') message += ' (Nghƒ©a thay th·∫ø ƒë√∫ng)';
        message += `<br>"${answer}"`;
        resultDiv.innerHTML = message;
        resultDiv.className = 'vocab-result correct';
        stats.correct++;
      }else{
        resultDiv.innerHTML = `‚ùå <strong>Sai r·ªìi!</strong><br>ƒê√°p √°n c·ªßa b·∫°n: "${answer}"<br>ƒê√°p √°n ƒë√∫ng: "${correctAnswer}"`;
        resultDiv.className = 'vocab-result incorrect';
        stats.wrong++;
      }
      resultDiv.classList.remove('hidden');
      
      stats.done++;
      updateStats();
      
      document.getElementById('checkBtn').classList.add('hidden');
      document.getElementById('nextBtn').classList.remove('hidden');
      document.getElementById('nextBtn').focus();
    }
    
    // Levenshtein distance algorithm for fuzzy matching
    function levenshteinDistance(str1, str2){
      const m = str1.length;
      const n = str2.length;
      const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
      
      for(let i = 0; i <= m; i++) dp[i][0] = i;
      for(let j = 0; j <= n; j++) dp[0][j] = j;
      
      for(let i = 1; i <= m; i++){
        for(let j = 1; j <= n; j++){
          if(str1[i-1] === str2[j-1]){
            dp[i][j] = dp[i-1][j-1];
          }else{
            dp[i][j] = Math.min(
              dp[i-1][j] + 1,    // deletion
              dp[i][j-1] + 1,    // insertion
              dp[i-1][j-1] + 1   // substitution
            );
          }
        }
      }
      return dp[m][n];
    }

    function nextWord(){
      currentIndex++;
      if(currentIndex >= vocabList.length){
        const score = stats.correct;
        const total = vocabList.length;
        const percentage = Math.round((score / total) * 100);
        alert(`üéâ Ho√†n th√†nh t·∫•t c·∫£ ${total} t·ª´!\n\nƒêi·ªÉm s·ªë: ${score}/${total} (${percentage}%)\n‚úÖ ƒê√∫ng: ${stats.correct}\n‚ùå Sai: ${stats.wrong}`);
        return;
      }
      showWord();
    }

    function resetTest(){
      document.getElementById('setupPhase').classList.remove('hidden');
      document.getElementById('testPhase').classList.add('hidden');
      vocabList = [];
      currentIndex = 0;
      userAnswers = [];
      stats = {done: 0, correct: 0, wrong: 0};
      updateStats();
    }

    function updateStats(){
      document.getElementById('statDone').textContent = stats.done;
      document.getElementById('statCorrect').textContent = stats.correct;
      document.getElementById('statWrong').textContent = stats.wrong;
    }

    // ===== Text to Speech =====
    function pronounceWord(){
      const word = document.getElementById('currentWord').textContent;
      if(!word || word === '‚Äî') return;
      
      // Check if browser supports speech synthesis
      if('speechSynthesis' in window){
        // Cancel any ongoing speech
        window.speechSynthesis.cancel();
        
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.lang = 'en-US'; // English pronunciation
        utterance.rate = 0.85; // Slightly slower for learning
        utterance.pitch = 1;
        utterance.volume = 1;
        
        window.speechSynthesis.speak(utterance);
      }else{
        alert('Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t √¢m t·ª± ƒë·ªông!\n\nVui l√≤ng s·ª≠ d·ª•ng Chrome, Edge, ho·∫∑c Safari.');
      }
    }
  </script>
</body>
</html>
